<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Feminatywów</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 600px;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .message-box {
            padding: 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
        }
        .success {
            background-color: #d1fae5;
            color: #065f46;
        }
        .error {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .instructions {
            background-color: #e2e8f0;
            border-left: 4px solid #94a3b8;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="container mx-auto p-4 sm:p-6 bg-white shadow-xl rounded-2xl border border-gray-200">
        <div class="space-y-4">
            <div>
                <label for="apiKey" class="block text-sm font-medium text-gray-700 mb-1">Twój klucz API (Gemini API):</label>
                <input type="password" id="apiKey" placeholder="Wklej tutaj swój klucz API" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
            </div>

            <div class="instructions p-3 rounded-lg">
                <p class="text-xs text-gray-700">
                    Wpisz nazwy zawodów (w rodzaju męskim), każda w nowej linii. AI wygeneruje ich żeńskie formy.
                </p>
            </div>

            <div>
                <label for="professionName" class="block text-sm font-medium text-gray-700 mb-1">Nazwy zawodów (jedna na linię):</label>
                <textarea id="professionName" rows="5" placeholder="np.&#10;programista&#10;lekarz&#10;nauczyciel" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"></textarea>
            </div>

            <div class="flex items-center justify-center space-x-2">
                <button id="generateBtn" class="bg-blue-600 text-white font-semibold py-2 px-4 sm:py-3 sm:px-6 rounded-lg shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out">Wygeneruj feminatywy</button>
                <div id="loadingIndicator" class="hidden">
                    <div class="loading-spinner"></div>
                </div>
            </div>

            <div>
                <label for="outputDescription" class="block text-sm font-medium text-gray-700 mb-1">Wygenerowane feminatywy:</label>
                <textarea id="outputDescription" rows="10" readonly placeholder="Wygenerowane formy żeńskie pojawią się tutaj..." class="w-full p-2 sm:p-3 bg-gray-50 border border-gray-300 rounded-lg shadow-sm"></textarea>
            </div>

            <div class="flex justify-center">
                <button id="copyBtn" class="bg-green-600 text-white font-semibold py-2 px-4 sm:py-3 sm:px-6 rounded-lg shadow-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-150 ease-in-out">Kopiuj do schowka</button>
            </div>
            
            <div id="messageBox" class="hidden text-center message-box"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const apiKeyEl = document.getElementById('apiKey');
            const professionNameEl = document.getElementById('professionName');
            const generateBtn = document.getElementById('generateBtn');
            const outputDescriptionEl = document.getElementById('outputDescription');
            const copyBtn = document.getElementById('copyBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const messageBox = document.getElementById('messageBox');

            let apiKey = "";
            const apiUrlBase = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=`;

            const storedApiKey = localStorage.getItem('geminiApiKey');
            if (storedApiKey) {
                apiKeyEl.value = storedApiKey;
            }

            const showMessage = (message, type) => {
                messageBox.textContent = message;
                messageBox.className = `message-box ${type} mt-3`;
                messageBox.style.display = 'block';
            };

            const generateFeminatives = async (professions, key) => {
                const professionList = professions.map(p => `- "${p}"`).join('\n');
                const prompt = `Proszę, wygeneruj żeńskie formy dla poniższych nazw zawodów w języku polskim. Zwróć tylko same formy żeńskie w tej samej kolejności co lista zawodów. Każda forma w nowej linii. Nie dodawaj żadnych dodatkowych słów, wstępów ani objaśnień.\n${professionList}`;
                
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: { temperature: 0.5, topP: 0.95 },
                };
                
                const apiUrl = `${apiUrlBase}${key}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        if (response.status === 400) {
                            throw new Error("Prawdopodobnie klucz API jest nieprawidłowy lub brakuje go w żądaniu.");
                        } else {
                            throw new Error(`API response failed with status: ${response.status}. Szczegóły: ${errorData.error.message}`);
                        }
                    }

                    const result = await response.json();
                    const feminativesText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (!feminativesText) {
                        throw new Error("API nie zwróciło poprawnej odpowiedzi.");
                    }
                    
                    const feminatives = feminativesText.trim().split('\n').map(f => f.replace(/^- /, '').trim());
                    
                    return feminatives;

                } catch (err) {
                    console.error('API call failed:', err);
                    throw err;
                }
            };

            const handleGeneration = async () => {
                outputDescriptionEl.value = '';
                messageBox.style.display = 'none';

                apiKey = apiKeyEl.value.trim();
                const professionsInput = professionNameEl.value.trim();

                if (!apiKey) {
                    showMessage('Proszę wprowadź swój klucz API.', 'error');
                    return;
                }
                localStorage.setItem('geminiApiKey', apiKey);

                const professions = professionsInput.split('\n').map(p => p.trim()).filter(p => p.length > 0);
                if (professions.length === 0) {
                    showMessage('Proszę wprowadź nazwy zawodów.', 'error');
                    return;
                }

                generateBtn.disabled = true;
                copyBtn.disabled = true;
                loadingIndicator.style.display = 'block';

                try {
                    const feminatives = await generateFeminatives(professions, apiKey);
                    const output = feminatives.join('\n');
                    
                    outputDescriptionEl.value = output;
                    showMessage('Wszystkie feminatywy zostały pomyślnie wygenerowane!', 'success');
                    
                } catch (err) {
                    const errorMessage = err.message.startsWith("Prawdopodobnie") ? err.message : `Wystąpił nieoczekiwany błąd. ${err.message}`;
                    showMessage(errorMessage, 'error');
                    outputDescriptionEl.value = professions.map(p => `Błąd: Nie można wygenerować feminatywu dla "${p}".`).join('\n');
                } finally {
                    generateBtn.disabled = false;
                    copyBtn.disabled = false;
                    loadingIndicator.style.display = 'none';
                }
            };

            const copyText = () => {
                outputDescriptionEl.select();
                try {
                    document.execCommand('copy');
                    showMessage('Tekst został skopiowany do schowka!', 'success');
                } catch (err) {
                    showMessage('Kopiowanie nie powiodło się.', 'error');
                }
            };

            generateBtn.addEventListener('click', handleGeneration);
            copyBtn.addEventListener('click', copyText);
        });
    </script>
</body>
</html>
